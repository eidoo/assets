
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eidoo App Changelog</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    html {
      font-size: 16px;
    }

    body {
      margin: 0 1rem;
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background-color: white;
      color: #121212;
    }

    body.dark-mode {
      background-color: #121212;
      color: rgba(256, 256, 256, 0.87);
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <h3 id="title" class="hidden">v<span id="version"></span></h3>
  <div id="content">

  </div>
  <script>
    document.addEventListener("DOMContentLoaded", async function() {
      const urlParams = new URLSearchParams(window.location.search)
      const style = urlParams.get('style')
      const locale = urlParams.get('locale')
      const version = urlParams.get('version')

      if (style === 'dark') {
        const $body = document.getElementsByTagName("body")[0]
        if ($body) {
          $body.setAttribute("class", "dark-mode")
        }
      }

      const content = document.getElementById('content')
      const versionsList = await loadVersionsList()
      const changelogFile = await loadChangeLog(version, locale, versionsList)

      document.getElementById('version').innerHTML = versionsList.pop()

      const featureList = document.createElement('ul')

      for (const feature of changelogFile.features) {
        const listItem = document.createElement('li')
        listItem.innerHTML = feature
        featureList.appendChild(listItem)
      }

      const featuresTitle = document.createElement('p')
      featuresTitle.innerHTML = 'New Features'
      content.appendChild(featuresTitle)
      content.appendChild(featureList)

      const fixesList = document.createElement('ul')
      for (const change of changelogFile.fixes) {
        const listItem = document.createElement('li')
        listItem.innerHTML = change
        fixesList.appendChild(listItem)
      }

      const fixesTitle = document.createElement('p')
      document.getElementById('title').className = ''
      fixesTitle.innerHTML = 'Bug fixes'
      content.appendChild(fixesTitle)
      content.appendChild(fixesList)
    })

    async function loadChangeLog(_currentVersion, _locale, _versionsList) {

      const versionsToLoad = _versionsList.slice(_versionsList.indexOf(_currentVersion) + 1)

      let changeLog = {
        fixes: [],
        features: []
      }

      for (const nextVersion of versionsToLoad) {
        const file = await fetch(`https://assets.eidoo.io/pages/changelogs/${nextVersion}.json`)
        const jsonLog = await file.json()
        changeLog.fixes.push(...jsonLog.fixes[_locale])
        changeLog.features.push(...jsonLog.features[_locale]) 
      }

      return changeLog
    }

    async function loadVersionsList() {
      const versions = await fetch(`https://assets.eidoo.io/pages/changelogs/versions.json`)
      return versions.json() 
    }

   
  </script>
</body>

</html>
